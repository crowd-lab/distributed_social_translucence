<html>
  <head>
      <title>Wait Page</title>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script>
        function political_affiliation() {
          var political = $("input[name='political':checked").val();
          if(political === 'Other') {
            political = 'Other: ' + $("input[name='other']").val()
          }
          var out_data = {political: political_affiiliation, turk_id: {{ turk_id }}}
          $.ajax({
            url: '/political_affiliation',
            type: 'POST',
            data: JSON.stringify(out_data),
            contentType: 'application/json;charset=UTF-8',
            dataType: 'json',
            success: function(data) {
              $('#political_form :input').prop('disabled', true)
            }
          });
        }
        function pollWorkReady() {
          var pairData = {pair_id: {{ pair_id }}};

          $.ajax({
            url: '/poll_work_ready',
            type: 'POST',
            data: JSON.stringify(pairData),
            contentType: 'application/json;charset=UTF-8',
            dataType: 'json',
            success: function(data) {
              if(data.status == 'success') {
                window.location.href = '/work';
              }
            }
          });
          return;
        }
        $(document).ready(function() {
            setInterval(pollWorkReady, 2000);
        });
      </script>
      <script>
        // TogetherJS configurations
        TogetherJSConfig_autoStart = true;
        TogetherJSConfig_findRoom = '{{ room_name }}';
        TogetherJSConfig_suppressJoinConfirmation = true;
        TogetherJSConfig_disableWebRTC = true;
        TogetherJSConfig_includeHashInUrl = false;
        TogetherJSConfig_cloneClicks = true;
        TogetherJSConfig_dontShowClicks = true;
        TogetherJSConfig_ignoreForms = true;
        TogetherJSConfig_getUserColor = function () {return '{{ user_color }}'};
      </script>
      <script src='{{ url_for('static', filename='js/togetherjs.js') }}'></script>
      <style>
        #togetherjs-container, .togetherjs-cursor {
          display: none !important;
        }
      </style>
      <link rel='stylesheet' href='{{ url_for('static', filename='css/fix.css') }}'></script>
  </head>
  <body>
    <p>Please wait until you are transferred to the task. You will be compensated for waiting.</p>
    <p>What is your political affiliation:</p>
    <form id='political_form'>
        <input type='radio' name='political' value='Liberal'>Liberal
        <input type='radio' name='political' value='Conservative'>Conservative
        <input type='radio' name='political' value='Other'> Other <input type='text' name='other' />
        <button onclick="political_affiliation">Submit</button>
      </form>
  </body>
</html>
