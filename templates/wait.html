<html>
  <head>
      <title>Wait Page</title>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script>
        function goToWork() {
            window.location.href = '/work';
        }

        function pollWorkReady() {
          var pairData = {'pair_id': {{ pair_id }}, 'role': '{{ role }}'};

          $.ajax({
            url: '/poll_work_ready',
            type: 'POST',
            data: JSON.stringify(pairData),
            contentType: 'application/json;charset=UTF-8',
            dataType: 'json',
            success: function(data) {
              console.log(data.status)
              if(data.status == 'success') {
                alert('Now transferring you to the task');
                {% if role == 'obs' %}
                    goToWork();
                {% else %}
                    setTimeout(goToWork, 3000);
                {% endif %}
              } else {
                  setTimeout(pollWorkReady, 2000);
              }
            },
            error: function() {
               console.error('Polling communication error');
               setTimeout(pollWorkReady, 2000);
            }
          });
          return;
        }
        $(document).ready(pollWorkReady);
      </script>
      <script>
        window.sessionStorage.removeItem('togetherjs-session.status')
        window.sessionStorage.removeItem('togetherjs-session.peerCache')
        window.localStorage.removeItem('togetherjs.identityId')
        window.localStorage.removeItem('togetherjs.settings.color')
        window.localStorage.removeItem('togetherjs.settings.name')
        window.localStorage.removeItem('togetherjs.settings.defaultName')
        window.localStorage.removeItem('togetherjs.settings.avatar')
      </script>
      <style>
        #togetherjs-container, .togetherjs-cursor {
          display: none !important;
        }
      </style>
      <link rel='stylesheet' href='{{ url_for('static', filename='css/fix.css') }}'></script>
  </head>
  <body>
    <H2><strong>Please leave this page open and wait until you are transferred to the task.</strong></H2>
    <p>Waiting is part of what you are being compensated for.</p>
  </body>
</html>
