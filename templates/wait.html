<html>
  <head>
      <title>Wait Page</title>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script>
        function goToWork() {
            window.location.href = '/work';
        }

        function pollWorkReady() {
          var pairData = {'pair_id': {{ pair_id }}, 'role': '{{ role }}'};

          $.ajax({
            url: '/poll_work_ready',
            type: 'POST',
            data: JSON.stringify(pairData),
            contentType: 'application/json;charset=UTF-8',
            dataType: 'json',
            success: function(data) {
              console.log(data.status)
              if(data.status == 'success') {
                {% if role == 'obs' %}
                    goToWork();
                {% else %}
                    setTimeout(goToWork, 3000);
                {% endif %}
              } else {
                  setTimeout(pollWorkReady, 2000);
              }
            },
            error: function() {
               console.error('Polling communication error');
               setTimeout(pollWorkReady, 2000);
            }
          });
          return;
        }
        $(document).ready(pollWorkReady);
      </script>
      <script>
        // TogetherJS configurations
        TogetherJSConfig_autoStart = true;
        TogetherJSConfig_findRoom = '{{ room_name }}';
        TogetherJSConfig_suppressJoinConfirmation = true;
        TogetherJSConfig_disableWebRTC = true;
        TogetherJSConfig_includeHashInUrl = false;
        TogetherJSConfig_cloneClicks = true;
        TogetherJSConfig_dontShowClicks = true;
        TogetherJSConfig_ignoreForms = true;

        window.sessionStorage.removeItem('togetherjs-session.status')
        window.sessionStorage.removeItem('togetherjs-session.peerCache')
      </script>
      <script src='{{ url_for('static', filename='js/togetherjs.js') }}'></script>
      <style>
        #togetherjs-container, .togetherjs-cursor {
          display: none !important;
        }
      </style>
      <link rel='stylesheet' href='{{ url_for('static', filename='css/fix.css') }}'></script>
  </head>
  <body>
    <p>Please wait until you are transferred to the task. You will be compensated for waiting.</p>
  </body>
</html>
